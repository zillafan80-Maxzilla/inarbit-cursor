---
description: Inarbit é«˜é¢‘äº¤æ˜“ç³»ç»Ÿ - å…¨ç¨‹ä»»åŠ¡æ¸…å•
---
# Inarbit HFT ç³»ç»Ÿå…¨ç¨‹ä»»åŠ¡

æ¯æ¬¡å¼€å§‹ä¼šè¯æ—¶ï¼Œè¯·æŒ‰ç…§æœ¬ä»»åŠ¡æ¸…å•ç»§ç»­æ‰§è¡Œæœªå®Œæˆçš„ä»»åŠ¡é¡¹ã€‚

---

## é¡¹ç›®æ¦‚è¿°

**Inarbit** æ˜¯ä¸€ä¸ªé«˜é¢‘åŠ å¯†è´§å¸å¥—åˆ©ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

- **Python API å±‚**: FastAPI + WebSocket
- **Rust æ ¸å¿ƒå¼•æ“**: é«˜æ€§èƒ½ç­–ç•¥æ‰§è¡Œ
- **React å‰ç«¯**: ç®¡ç†ç•Œé¢
- **æ•°æ®åº“**: PostgreSQL + Redis
- **é£é™©ç®¡ç†**: å…¨å±€é£æ§ä½“ç³»

---

## é˜¶æ®µ 0: åŒæ­¥ä¸æ¸…ç† âœ…

- [x] åŒæ­¥åˆ° upstream-vscode/main
- [x] æ¸…ç† Firebase/é—ç•™æ¨¡å—
- [x] ç»Ÿä¸€ WebSocket ä¸ API é»˜è®¤ç«¯å£
- [x] æ¸…ç†æ— ç”¨å…¥å£ä¸ç©ºç›®å½•

## é˜¶æ®µ 1: è¿è¡Œé…ç½®ä¸€è‡´æ€§ âœ…

- [x] æ–‡æ¡£/è„šæœ¬ç«¯å£ç»Ÿä¸€ä¸º `8000`
- [x] å‰ç«¯ WS/ä»£ç†é…ç½®ä¸€è‡´
- [x] `.env.example` ä»…ä¿ç•™ API/WS é…ç½®

## é˜¶æ®µ 2: æ•°æ®ä¸æœºä¼šç®¡çº¿ ğŸ”„

- [ ] è¡Œæƒ…å†™å…¥ Redis ä¸æŒ‡æ ‡éªŒè¯
- [ ] ä¸‰è§’/æœŸç°æœºä¼šè¾“å‡ºéªŒè¯
- [ ] å†³ç­–æœåŠ¡çº¦æŸé“¾è·¯éªŒè¯
- [ ] metrics/monitoring æŒ‡æ ‡æ ¸å¯¹

## é˜¶æ®µ 3: OMS æ‰§è¡Œé—­ç¯ ğŸ”„

- [ ] æ‰§è¡Œè®¡åˆ’åˆ›å»ºä¸çŠ¶æ€å›å†™
- [ ] è®¢å•/æˆäº¤/PNL è¡¨é—­ç¯éªŒè¯
- [ ] å¯¹è´¦/å–æ¶ˆ/åˆ·æ–°æ¥å£å¥å£®æ€§éªŒè¯
- [ ] WS è®¢å•æ¨é€å­—æ®µè§„èŒƒåŒ–

## é˜¶æ®µ 4: é£æ§é—­ç¯ ğŸ”„

- [ ] RiskManager è¿æ¥å™¨å®ç°å®Œå¤‡
- [ ] é£æ§é˜ˆå€¼/è§„åˆ™å¯é…ç½®åŒ–
- [ ] panic/reset/reload_keys ç«¯åˆ°ç«¯éªŒè¯

## é˜¶æ®µ 5: Rust å¼•æ“å®Œå–„ ğŸ”„

- [ ] executor çœŸå®ä¸‹å•ä¸å›æŠ¥å¤„ç†
- [ ] risk æ¨¡å—æ£€æŸ¥é€»è¾‘è¡¥é½
- [ ] ä¸ Python/Redis è”è°ƒéªŒè¯

## é˜¶æ®µ 6: æµ‹è¯•ä¸æ–‡æ¡£ ğŸ”„

- [ ] é›†æˆæµ‹è¯•ä¸å›å½’æµ‹è¯•è¡¥é½
- [ ] å‰ç«¯å…³é”®è·¯å¾„ E2E
- [ ] walkthrough æ–‡æ¡£å¤æ ¸

---

## æ‰§è¡Œè¯´æ˜

1. ä¼˜å…ˆå®Œæˆé˜¶æ®µ 2/3 çš„æ ¸å¿ƒé“¾è·¯éªŒè¯
2. ç„¶åè¡¥é½é˜¶æ®µ 4/5 çš„é£æ§ä¸å¼•æ“ TODO
3. æœ€åå®Œå–„æµ‹è¯•ä¸æ–‡æ¡£

---

## å½“å‰æ–­ç‚¹ï¼ˆ2026-01-30ï¼‰

### æœ¬æ¬¡å®Œæˆå¹¶æ¨é€

- é›†æˆæµ‹è¯•æ”¹ä¸º ASGI è¿›ç¨‹å†…è°ƒç”¨ï¼Œé¿å…ä¾èµ–å¤–éƒ¨ç«¯å£
- è¡Œæƒ…é‡‡é›†/å†³ç­–/é£æ§é…ç½®é¡¹è¡¥å……å¹¶æ”¯æŒè¿è¡Œæ—¶è°ƒä¼˜
- èµ„é‡‘è´¹ç‡å¼‚å¸¸æ”¯æŒ fail-open é€‰é¡¹ï¼ˆå¯é…ç½®ï¼‰
- PostgreSQL é»˜è®¤å¯†ç å‘Šè­¦æç¤º
- æ¸…ç†è¿è¡Œæ—¶è°ƒè¯•åŸ‹ç‚¹ä¸ä¸´æ—¶æ—¥å¿—

### å·²å®Œæˆå¹¶æ¨é€

- ä¿®å¤ MaxDrawdownCircuitBreaker å³°å€¼æ›´æ–°ï¼ˆa0c3df5ï¼‰
- è¡¥é½ init.sql ä¸ migration_v5ï¼ˆ35c9a2bï¼‰
- start_server è‡ªåŠ¨ç«¯å£å›é€€å¹¶å†™å…¥ `.cursor/api_port.json`ï¼ˆ35c9a2bï¼‰
- æµ‹è¯•ç”¨ä¾‹è¯»å–åŠ¨æ€ API baseï¼Œå›å½’é€šè¿‡ï¼ˆ35c9a2bï¼‰
- è¡¥é½/ä¿®å¤æ ¸å¿ƒæ¨¡å—ï¼šconfig_serviceã€risk_managerã€api/routesã€engine main/strategyï¼ˆ35c9a2bï¼‰
- `.cursor/` å·²ç§»å‡ºä»“åº“å¹¶åŠ å…¥å¿½ç•¥ï¼ˆ5f0d1acï¼‰

### å·²éªŒè¯

- å¥åº·æ£€æŸ¥ï¼š`GET /health` â†’ 200
- å›å½’æµ‹è¯•ï¼š`python -m pytest -q` â†’ 34 passed, 8 skipped, 1 warning

### å¾…ç»§ç»­

- é˜¶æ®µ 2/3/4/5 çš„é“¾è·¯éªŒè¯ä»æœªå®Œæˆ
- è¡Œæƒ… -> æœºä¼š -> å†³ç­– -> OMS -> PnL é—­ç¯éªŒè¯
- é£æ§è¿æ¥å™¨çœŸå®æ•°æ®æºå¯¹æ¥ä¸é˜ˆå€¼è°ƒå‚
- Rust executor çœŸå®ä¸‹å•ä¸å›æŠ¥å¤„ç†è¡¥é½
- å‰ç«¯å…³é”®è·¯å¾„ E2E ä¸æ–‡æ¡£å¤æ ¸

### å¼€å‘æç¤º

- Git æ¨é€è¯·ä½¿ç”¨ï¼š`scripts/git_ssh_443.ps1 push`
- åç«¯å¯åŠ¨ï¼š`python start_server.py`
- API åŸºå€ï¼šè¯»å– `.cursor/api_port.json` çš„ `base`

### SSH 22/433 ä¸é€šæ ¹å› ä¸ä¿®å¤ï¼ˆ2026-01-31ï¼‰

**æ ¹å› æ€»ç»“**
- `433` ä¸ºé”™è¯¯ç«¯å£ï¼ˆåº”ä¸º `443`ï¼‰ï¼Œå®ä¾‹æœªç›‘å¬ä¸”é˜²ç«å¢™æœªæ”¾è¡Œè¯¥ç«¯å£ã€‚
- `22` ç«¯å£è™½æ”¾è¡Œï¼Œä½† `sshd` ä»å— GCE Guest Agent/OS Login çš„ `AuthorizedKeysCommand` å½±å“ï¼Œroot å…¬é’¥æœªç¨³å®šè½ç›˜ï¼ˆå«ç¼–ç /BOM å½±å“ï¼‰ï¼Œå¯¼è‡´è®¤è¯é˜¶æ®µè¢«å…³é—­ã€‚
- è¿æ¥ç«¯å£ä¸ç”¨æˆ·é…ç½®æœªç»Ÿä¸€ï¼Œé€ æˆå¤šæ¬¡åˆ‡æ¢ç«¯å£/ç”¨æˆ·åï¼Œè¡¨ç°ä¸ºè¿æ¥ä¸ç¨³å®šã€‚

**æœ€ç»ˆè§£å†³æ–¹æ¡ˆ**
- é€šè¿‡ `startup-script` æ˜¾å¼å†™å…¥ `/root/.ssh/authorized_keys`ï¼Œåœ¨ `sshd_config.d` ä¸­ç¦ç”¨ `AuthorizedKeysCommand`ï¼Œå¹¶ç¦ç”¨å¯†ç ç™»å½•ã€‚
- å›ºå®š SSH ç«¯å£ä¸º `2222` å¹¶æ”¾è¡Œé˜²ç«å¢™ï¼›`22` ä»…ä½œå¤‡ç”¨ï¼Œ`443` é¢„ç•™ç»™ HTTPSã€‚
- æœ¬åœ° `.ssh/config` å¢åŠ  `Host inarbit2222` ç»Ÿä¸€å…¥å£ã€‚

**å‚è€ƒå‘½ä»¤**
- æ”¾è¡Œç«¯å£ï¼š`gcloud compute firewall-rules create allow-ssh-2222 --project www-inarbit-work --allow tcp:2222 --target-tags http-server,https-server --source-ranges 0.0.0.0/0`
- æµ‹è¯•ç™»å½•ï¼š`ssh -p 2222 -i C:\Users\å‘¨æµ©\.cursor\cursor-workspace\inarbit\gcp_server_key root@136.109.140.114`

### è¿œç¨‹éƒ¨ç½²è¿›åº¦ï¼ˆ2026-01-31ï¼‰

**å·²å®Œæˆ**
- ä»£ç éƒ¨ç½²åˆ° `/opt/inarbit`ï¼Œåç«¯ä¾èµ–å®‰è£…å®Œæˆï¼ˆ`venv`ï¼‰
- æ•°æ®æœåŠ¡ï¼š`docker-compose up -d` å¯åŠ¨ PostgreSQL/Redis
- åˆå§‹åŒ–ï¼š`INARBIT_INIT_CONFIRM=YES INARBIT_SKIP_EXCHANGE=1 ./venv/bin/python test_system_init.py`
- API æœåŠ¡ï¼š`/etc/systemd/system/inarbit-api.service` å¹¶å·² `enable --now`
- å‰ç«¯æ„å»ºï¼š`cd /opt/inarbit/client && npm run build`
- Nginxï¼š`/etc/nginx/sites-available/inarbit`ï¼Œåå‘ä»£ç† `/api` ä¸ `/ws`
- è¿œç¨‹æµ‹è¯•ï¼š`python -m pytest -q` â†’ `37 passed, 5 skipped, 1 warning`

**å¾…å¤„ç†**
- HTTPS è¯ä¹¦ï¼šCertbot å¤±è´¥ï¼ŒåŸŸåä»æŒ‡å‘ `35.212.164.201`ï¼ˆæ—§ IPï¼‰
  - å°† `inarbit.work` ä¸ `www.inarbit.work` çš„ A è®°å½•æ›´æ–°ä¸º `136.109.140.114`
  - ç¡®è®¤ 80/443 é˜²ç«å¢™æ”¾è¡Œåé‡è¯•ï¼š
    `certbot --nginx -d inarbit.work -d www.inarbit.work --non-interactive --agree-tos -m admin@inarbit.work --redirect`
